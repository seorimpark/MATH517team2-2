---
title: "matias_analysis"
author: "Matias Janvin"
date: "11/9/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


````{r, message=FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)
library(corrplot)
library(maps)
library(survival)
library(timereg)
library(quantreg)
````


# Read data
````{r, message=FALSE}
load("../Data/data_train_DF.RData")
data = data_train_DF
````




## Mean temperature over time
We observe that temperature has been rising the past year. A question of interest is whether this exacerbates wildfires in areas that are prone to them.
```{r}
mean.temp<-rep(0,length(unique(data$year)))
for (i in unique(data$year)){
  mean.temp[match(i,unique(data$year))]<-mean(data$clim4[data$year==i])
}
plot(unique(data$year),mean.temp, 'l')
```


## CDF to study the overall distribution of events
From the CDF, we see that there is considerable heterogeneity in risk of wildfire. The distribution has a long tail, consisting of a small number of areas with a large number of fires.
```{r}
plot(ecdf(data$CNT), main='CDF for number of wildfires')
# cumsum(table(data$CNT))/sum(!is.na(data$CNT))
# unique(data$year)
```



## Quantile regression
Here, we investigate the association between temperature and the number of wildfires in addition to the association between temperature and burnt area through scatter-plots and subsequently through quantile regression, restricted to random samples of 10 000 geographical locations from the year 2015. As a control, we consider associations between the proportion of landcover constituted by water and the number of wildfires 


```{r}
set.seed(7)
sample<-data[sample(1:nrow(data[data$year==2015,]),10000),]
# Number of wildfires
# Scatter plot
plot(sample$clim4,sample$CNT)
# Quantile regression
fm <- rq(CNT ~ clim4, data = sample, tau =  0.6+ 1:39/100)
## visualizations
# plot(fm)
plot(fm, parm = 2, mar = c(5.1, 4.1, 2.1, 2.1), main = "", xlab = "tau",
ylab = "number of fires", cex = 1, pch = 19)

# Burnt area
plot(sample$clim4,sample$BA)
# Quantile regression
fm <- rq(BA ~ clim4, data = sample, tau =   0.6+ 1:39/100)
# plot(fm)
plot(fm, parm = 2, mar = c(5.1, 4.1, 2.1, 2.1), main = "", xlab = "tau",
ylab = "Burnt area", cex = 1, pch = 19)



# Quantile regression for proportion of water
# Scatter plot
plot(sample$lc18,sample$CNT)
# Quantile regression
sample<-data[sample(1:nrow(data[data$year==2015,]),10000),]
fm <- rq(CNT ~ lc18, data = sample, tau =  0.6+ 1:39/100)
## visualizations
# plot(fm)
plot(fm, parm = 2, mar = c(5.1, 4.1, 2.1, 2.1), main = "", xlab = "tau",
ylab = "number of fires", cex = 1, pch = 19)

# Burnt area
plot(sample$lc18,sample$BA)
# Quantile regression
fm <- rq(BA ~ lc18, data = sample, tau =   0.6+ 1:39/100)
# plot(fm)
plot(fm, parm = 2, mar = c(5.1, 4.1, 2.1, 2.1), main = "", xlab = "tau",
ylab = "Burnt area", cex = 1, pch = 19)



```


Whereas the association between temperature and number of wildfires is not so clear in the marginal scatterplots, we observe a very clear association within strata given by percentiles of number of wildfires or burnt area. This indicates that temperature has a heterogeneous effect on wildfires: it is evident that temperature exacerbates the probability of wildfires in areas that are prone to these. The negative control shows what we expect: areas which are susceptible to wildfires experience substantially less of these the larger the proportion of landcover that is constituted by water. These illustrations highlight the power of quantile regression in elucidating heterogenous covariate effects across the different geographical locations considered in the dataset.


