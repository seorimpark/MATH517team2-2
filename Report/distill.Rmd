---
title: "Wildfires in the US"
description: |
  Statistical computation and visualization (MATH-517)
date: November 16, 2021
author:
- name: "Zineb AGNAOU"  
  url: https://github.com/ZinebAg
- name: "Fahim BECK"
  url: https://github.com/FahimBeck
- name: "Salima JAOUA"
  url: https://github.com/salimajaoua
- name: "Matias JANVIN"
  url: https://github.com/matiasjanvin
- name: "Seorim PARK"
  url: https://github.com/seorimpark
output: distill::distill_article
---
<style>
body {text-align: justify}
body {text-justify: inter-word}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
```

## Introduction


### Research questions


### Approaches


## Sources of information / datasets

Transformations to talk :

* Wind speed in one variable 
* Temperatures in Celsius

## Packages

Here are some packages used in our project. Make sure they are installed before running the R Markdown file. Since the format of this Markdown is not standard, you need to install the *Distill* package. To avoid errors, install it via [Github](https://github.com/rstudio/distill) (the package is updated there) with the following commands: <br>
`install.packages("devtools")` <br>
`devtools::install_github("rstudio/distill")`

````{r, message=FALSE}

library(ggplot2)
library(tidyr)
library(dplyr)
library(corrplot)
library(maps)

````


## Visualisation and interactive / animated maps

## Wildfires over time

## Wildfires and the land cover

## Wildfires and meteorogical factors

In this section, we try to find some meteorological factors that could potentially trigger a wildfire. To do so, we will plot a Pearson correlation heatmap. The first step is to get a subset from our initial dataset that is more representative of wildfire conditions. As a fire is quite a rare event, we will not be able to find any links if we were considering the entire population (the correlations would be around 0). 

````{r, include=FALSE}

# Read data
load("../Data/data_train_DF.RData")
data = data_train_DF

# Explore data
dim(data)
names(data)

# Remove NA values from CNT and BA
data <- data[!is.na(data$CNT),]
data <- data[!is.na(data$BA),]

# Remove columns not related to weather
remove = c(paste("lc", seq(1:18), sep = ""), "altiMean", "altiSD")
data = data[, -which(names(data) %in% remove)]

# Renaming weather columns
data<-data%>% dplyr::rename(NSwind=clim1, WEwind=clim2, dew_temperature=clim3, temperature=clim4, 
         potential_evaporation=clim5, solar_radiation= clim6, 
         thermal_radiation=clim7, pressure=clim8, evaporation=clim9, 
         precipitation=clim10)

# Wind into one component 
data <- data %>% mutate(Wspeed=(sqrt(NSwind^2+WEwind^2))) %>% select(-NSwind, -WEwind)

# Temperatures in Celsius
data$dew_temperature = data$dew_temperature - 273.15
data$temperature = data$temperature - 273.15

# Overview
names(data)
sapply(data, range)
head(data)

````

To get our subset, we will only consider areas per month which have at least a certain number of wildfires and which have been burnt above a certain threshold. For our example, we take rows with more than 60 wildfires ($CNT \geq 60$) and 5000 acres of aggregated burnt area ($BA \geq 5000$, approximately 20km<sup>2</sup>) in the current month. 


````{r, include=FALSE}

# Parameters for sub-setting
lim_CNT = 60
lim_BA = 5000

# Subset and check
selection = data[data$CNT >= lim_CNT & data$BA >= lim_BA,]
dim(selection)
names(selection)
range(selection$month)

````

We check whether the period in years of the subset matches that of the initial dataset, i.e. 1993 to 2015. We see that it does. 

````{r}

range(selection$year)

````

As a result, a correlation heatmap will allow us to distinguish certain factors that could favor a wildfire. 

````{r, fig.width=7, fig.height=7, echo=FALSE}

# Correlations
sel = cor(selection)

# Plot
corrplot(sel, method = "color", addCoef.col="black", tl.cex = 0.8, cl.cex = 0.8,
               number.cex = 0.7, number.digits = 2)

````

Since we are looking for meteorological risk factors, we may only consider the first two rows or columns of the heatmap. 


First, we see that there are no pairs of fully correlated variables. Indeed, the highest value (absolute) is 0.43. The number of wildfires and months are negatively correlated. This can be explained by the fact that months range from March to September and that there are more occurrences of fire in March and April than in August and September. The fact that the numbers are small shows that the causes of a wildfire are meteorologically multifactorial.

An interesting observation is that $CNT$ and $BA$ are negatively correlated, meaning that the more area burnt, the fewer wildfires there are. Most of the time, the signs of correlations in the first two rows are not the same for these two variables. For example, by looking at temperatures and solar radiation, the higher they are, the more area burnt, but the less wildfires. This can be explained by the fact that our subset contains substantial wildfires, so there aren't many, but they are destructive.

Another variable that we can comment on is precipitation. For an area to be burnt, there must be no rain or high humidity conditions, hence the negative correlations between $BA$ and precipitation. The positive correlation with $CNT$ could be explained by unstable weather conditions. As with wind speed, the higher it is, the more unstable the air masses and the greater the risk of a natural disaster.

But we should be careful with these correlations as we used a subset and as their values are not that high in absolute value. 

Next, a map of the US represents the areas considered in the subset, regardless of months and years.

````{r, echo=FALSE}

# Finding considered areas
loc = unique( selection[, c("lon", "lat", "area")] )
us <- map_data('state')

# Plot areas
ggplot() + 
  geom_map(aes(map_id=region), fill="white", color="black", size=0.15, map=us, data=us) +
  expand_limits(x = us$long, y = us$lat) +
  geom_point(data=loc, aes(x=lon, y=lat, size=area*2.7), colour="red", shape=15) +
  scale_size_identity() + 
  theme(panel.border = element_blank(), panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  theme(axis.title.x=element_blank(), axis.text.x=element_blank(),
        axis.ticks.x=element_blank(), axis.title.y=element_blank(),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        plot.title = element_text(size=18, hjust=0.5, vjust=2)) + 
  ggtitle('Areas considered in the subset') + 
  coord_fixed(1.3)

````

It can be seen that the areas represented are not that many in number and are located where the forest cover is the most important. For example, there are almost no red squares in the central region of the United States, as this area is mostly non-forest land.

For other thresholds, an interactive app is available [here](https://fahimbeck.shinyapps.io/wildfires_mfactors/). Instructions and explanations are displayed on the app. Basically, you have the same results as above, but thresholds for $CNT$ and $BA$ are entered by the user. 


## Discussion and conclusion 


## Future improvements 



